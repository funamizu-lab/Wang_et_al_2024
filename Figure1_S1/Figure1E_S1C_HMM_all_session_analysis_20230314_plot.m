%{
----------------------------------------------------------------------------
Analyzing behavioral data
At least for the correct rate
----------------------------------------------------------------------------
%}

function Figure1E_S1C_HMM_all_session_analysis_20230314_plot

%Remove not good sessions
repeat_first = [
0.0969	0.0908	0.1835	0.1345	0.2025	0.2021	0.2328
0.235	0.3002	0.2083	0.3112	0.2606	0.3382	0.3187
0.1829	0.1956	0.1819	0.1118	0.2196	0.2749	0.2585
0.1878	0.1137	0.211	0.153	0.1859	0.2031	0.2711
0.2016	0.3597	0.3649	0.2979	0.2638	0.308	0.2634
0.107	0.1586	0.1004	0.0811	0.265	0.2888	0.3169
0.0541	0.1233	0.2822	0.2859	0.116	0.1939	0.111
0.0976	0.1099	0.0538	0.1213	0.1339	0.1905	0.1522
    ];
zigzag_first = [
-0.0419	-0.1083	-0.1147	-0.2356	-0.1817	-0.1882	-0.2305
-0.0478	-0.0942	-0.2514	-0.4167	-0.2667	-0.3203	-0.4324
-0.0717	-0.0608	-0.1653	-0.0304	-0.0736	-0.1792	-0.2655
0.1101	0.0151	-0.0963	-0.1763	-0.1209	-0.2195	-0.1924
-0.0847	-0.216	-0.1632	-0.1991	-0.4086	-0.2968	-0.2331
-0.0056	0.0669	-0.0245	-0.0812	-0.1784	-0.1441	-0.16
0.0079	-0.0235	-0.0109	-0.0702	-0.0262	0.1668	-0.0254
0.0698	-0.1356	-0.0682	-0.1109	-0.1887	-0.0323	-0.0317
-0.1895	-0.1114	-0.2213	-0.199	-0.2362	-0.4367	-0.343
-0.1297	-0.0414	-0.2061	-0.0656	-0.1253	0.0426	-0.0754
-0.026	0.0139	0.001	-0.0808	0.0077	-0.1161	-0.2208
    ];
repeat_first_day = [3 1 1 1 1 2 2 5];
zigzag_first_day = [4 3 3 3 2 5 10 9 1 3 7];

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%Include all sessions
repeat_first2 = [
0.0969	0.0908	-0.0581	0.1835	0.1345	0.2025	0.2021	0.2328	0.2358
0.235	0.3002	0.3217	0.1621	0.2547	0.4164	0.301	0.3107	0.2083
0.1829	0.1956	0.1819	0.1118	0.2196	0.1851	0.2749	0.2395	0.2585
0.1878	0.1137	0.211	0.153	0.1859	0.2031	0.2711	0.3411	0.2485
0.1998	0.2743	0.2016	0.3597	0.1395	0.1549	0.2165	0.3649	0.2979
0.107	0.1391	0.1586	0.1004	0.0811	0.265	0.2888	0.3169	0.2947
0.0541	0.1233	0.2822	0.2859	0.116	0.1939	0.111	-0.003	0.2136
0.0976	0.1099	0.0538	0.1213	0.1339	0.1905	0.1522	0.0786	-0.0011
    ];
zigzag_first2 = [
-0.0526	-0.0419	-0.1083	-0.1147	-0.2356	-0.1817	-0.1882	-0.2305	-0.1808
-0.0478	-0.0942	-0.2514	-0.115	-0.4167	-0.2667	-0.3203	-0.4324	-0.382
-0.0717	-0.0608	-0.1653	-0.0304	-0.0736	-0.1792	-0.2655	-0.2248	-0.3403
0.0074	0.1101	-0.0245	0.0052	0.0151	0.0446	-0.0611	-0.0203	-0.0069
0.083	-0.0847	-0.216	-0.1632	-0.1991	-0.4086	-0.2968	-0.2331	-0.5331
-0.0056	0.0669	-0.0245	-0.0812	-0.1784	-0.1441	-0.16	-0.1939	-0.3581
0.0079	-0.0235	-0.0109	-0.0702	-0.0262	0.1668	-0.0254	-0.1494	-0.0629
0.0698	-0.1356	-0.0682	-0.1109	-0.1887	-0.0323	-0.0317	-0.0479	-0.0175
-0.1895	-0.1114	-0.2213	-0.199	-0.2362	-0.4367	-0.343	-0.2506	-0.256
-0.1297	-0.0242	-0.0414	-0.2061	-0.0656	-0.1253	0.0426	-0.0754	-0.0515
-0.026	0.0139	0.001	-0.0808	-0.0056	0.0077	-0.1161	-0.2208	-0.1138
    ];
repeat_first_day2 = [4 1 1 1 1 2 2 5];
zigzag_first_day2 = [5 3 3 12 3 5 10 11 1 4 8];

repeat_first2 = repeat_first2(:,1:7);
zigzag_first2 = zigzag_first2(:,1:7);

%Analysis
analysis_repeat_zigzag(repeat_first_day, zigzag_first_day,repeat_first,zigzag_first,1)
analysis_repeat_zigzag(repeat_first_day2, zigzag_first_day2,repeat_first2,zigzag_first,2)

return

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function analysis_repeat_zigzag(repeat_first_day, zigzag_first_day,repeat_first,zigzag_first,flag)
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

[~,size_x] = size(repeat_first);
p_each_day = nan(2,size_x);
for i = 1:size_x
    p_each_day(1,i) = signrank(repeat_first(:,i));
    p_each_day(2,i) = signrank(zigzag_first(:,i));
end
ranksum(repeat_first_day, zigzag_first_day)

if flag == 1
    tmptitle = 'Good sessions';
else
    tmptitle = 'All sessions';
end

figure
plot_mean_se_moto(repeat_first,[0 0.5 0],2)
hold on
plot_mean_se_moto(zigzag_first,'m',2)
xlabel('Number of session')
ylabel('Rightward â–³fraction')
yline(0,':k')
title(tmptitle)
set(gca,'xlim',[0.5 size_x + 0.5])

rand_x1 =  0.2 * (rand(1,length(repeat_first_day)) - 0.5);
rand_x2 =  0.2 * (rand(1,length(zigzag_first_day)) - 0.5);

figure
boxplot([repeat_first_day, zigzag_first_day],[zeros(1,length(repeat_first_day)), ones(1,length(zigzag_first_day))])
hold on
plot(rand_x1 + 1, repeat_first_day,'k.')
hold on
plot(rand_x2 + 2, zigzag_first_day,'k.')
ylabel('Number of sessions')
title(tmptitle)





